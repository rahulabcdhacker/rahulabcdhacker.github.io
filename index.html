<!-- 1. HEAD SECTION: Remove EmailJS script -->
<head>
  <!-- Remove this line entirely -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
</head>

<!-- 2. MAIN SCRIPT: Replace EmailJS init and send blocks -->
<script>
  // --- REMOVE THESE LINES START ---
  // Initialize EmailJS
  emailjs.init("YOUR_EMAILJS_USER_ID");

  // Submit Order with EmailJS
  document.getElementById('submitOrder').addEventListener('click', async () => {
      const name    = document.getElementById('customerName').value.trim();
      const email   = document.getElementById('customerEmail').value.trim();
      const phone   = document.getElementById('customerPhone').value.trim();
      const address = document.getElementById('customerAddress').value.trim();

      if (!name || !email || !phone || !address || cart.length === 0) {
          alert('Please fill all fields and add items to cart.');
          return;
      }

      loadingSpinner.classList.remove('hidden');

      try {
          await emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', {
              customer_name: name,
              customer_email: email,
              customer_phone: phone,
              customer_address: address,
              order_items: cart.map(item => `${item.name} x${item.quantity} (₹${item.price * item.quantity})`).join(', '),
              order_total: cart.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2),
              order_date: new Date().toLocaleString()
          });

          toggleModal(checkoutModal, false);
          toggleModal(confirmationModal, true);
          cart = [];
          saveCart(); updateCart();
          ['customerName','customerEmail','customerPhone','customerAddress'].forEach(id => document.getElementById(id).value = '');
      } catch (error) {
          alert('Failed to send order. Please try again.'); console.error(error);
      } finally {
          loadingSpinner.classList.add('hidden');
      }
  });
  // --- REMOVE THESE LINES END ---

  // --- ADD FORMPSPREE HANDLER BELOW THIS LINE ---
  document.getElementById('submitOrder').addEventListener('click', async () => {
      const name    = document.getElementById('customerName').value.trim();
      const email   = document.getElementById('customerEmail').value.trim();
      const phone   = document.getElementById('customerPhone').value.trim();
      const address = document.getElementById('customerAddress').value.trim();

      if (!name || !email || !phone || !address || cart.length === 0) {
          alert('Please fill all fields and add items to cart.');
          return;
      }

      loadingSpinner.classList.remove('hidden');

      const payload = {
          name,
          email,
          phone,
          address,
          items: cart.map(item => `${item.name} x${item.quantity} (₹${item.price * item.quantity})`).join(", "),
          total: cart.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2),
          date: new Date().toLocaleString()
      };

      try {
          const response = await fetch('https://formspree.io/f/YOUR_FORM_ID', {
              method: 'POST', headers: {
                  'Content-Type': 'application/json', 'Accept': 'application/json'
              }, body: JSON.stringify(payload)
          });

          if (response.ok) {
              toggleModal(checkoutModal, false);
              toggleModal(confirmationModal, true);
              cart = []; saveCart(); updateCart();
              ['customerName','customerEmail','customerPhone','customerAddress'].forEach(id => document.getElementById(id).value = '');
          } else {
              const err = await response.json(); console.error('Formspree error:', err);
              alert('Failed to send order: ' + (err.error || response.statusText));
          }
      } catch (e) {
          console.error('Fetch error:', e);
          alert('Network error. Please try again later.');
      } finally { loadingSpinner.classList.add('hidden'); }
  });
</script>
